@using app.BLL
@model ShoppingCart


<!-- top Products -->
<div class="ads-grid_shop">
	<div class="shop_inner_inf">
		<div class="privacy about">
			<h3>Chec<span>kout</span></h3>

			<div class="checkout-right">
@* 				<h4>Your shopping cart contains: <span>3 Products</span></h4> *@
				<table class="timetable_sub">
					<thead>
						<tr>
							<th>SL No.</th>
							<th>Product</th>
							<th>Quality</th>
							<th>Product Name</th>
							<th>Single Price</th>
							<th>Total Price</th>
							<th>Remove</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model.Items)
						{
							<tr class="rem1">
								<td class="invert">1</td>
								<td class="invert-image">
									<a href="single.html"><img src="@item.Image" alt="" class="img-responsive" /></a>
								</td>
								<td class="invert">@item.Name</td>

								<td class="invert">
									<div class="quantity">
										<div class="quantity-select">
											<div class="entry value-minus " data-itemid="@item.ProductId" data-quantity="@item.Quantity">&nbsp;</div>
											<div class="entry value"><span>@item.Quantity</span></div>
											<div class="entry value-plus " data-itemid="@item.ProductId" data-quantity="@item.Quantity">&nbsp;</div>
										</div>
									</div>
								</td>
								<td class="invert">
									@* <span class="item-price">$@(item.Price * item.Quantity)</span> *@
									<span class="item-price">@item.Price</span>
								</td>

								<td class="invert">
									<span class="total-price">@(item.Price*item.Quantity)</span>
								</td>


								<td class="invert">
									<div class="rem">
										<a asp-action="RemoveFromCart" asp-route-productId="@item.ProductId">Remove</a>
									</div>
								</td>
							</tr>
						}

					</tbody>
				</table>
			</div>
			<div class="checkout-left">
				<div class="col-md-4 checkout-left-basket">
					<a href="~/shoes/shop">
						<h4>Continue to basket</h4>
					</a>

					<ul>
						@foreach (var item in Model.Items)
						{
							<li>@item.Name <i> - </i> <span>$@item.Price</span> x @item.Quantity</li>
						}
						@* <li>Total Service Charges <i> - </i> <span>$@Model.ServiceCharges</span></li> *@
						@* <li>Total <i> - </i> <span>$@Model.Items.Sum(i => i.Price * i.Quantity)</span></li> *@
						<li>Total <i> - </i> <span class="total-price-hd">$@Model.Items.Sum(i => i.Price * i.Quantity)</span></li>
					</ul>
				</div>

				</div>
				

				<div class="clearfix"> </div>
			<div class="checkout-right-basket">
				<a asp-action="Checkout" >Thanh toán</a>
			</div>

				<div class="clearfix"></div>
			</div>
		</div>
	</div>
	<!-- //top products -->
	<div class="mid_slider_w3lsagile">
		<div class="col-md-3 mid_slider_text">
			<h5>Some More Shoes</h5>
		</div>
		<div class="col-md-9 mid_slider_info">
			<div id="myCarousel" class="carousel slide" data-ride="carousel">
				<!-- Indicators -->
				<ol class="carousel-indicators">
					<li data-target="#myCarousel" data-slide-to="0" class=""></li>
					<li data-target="#myCarousel" data-slide-to="1" class="active"></li>
					<li data-target="#myCarousel" data-slide-to="2" class=""></li>
					<li data-target="#myCarousel" data-slide-to="3" class=""></li>
				</ol>
				<div class="carousel-inner" role="listbox">
					<div class="item">
						<div class="row">
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g1.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g2.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g3.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g4.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
						</div>
					</div>
					<div class="item active">
						<div class="row">
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g5.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g6.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g2.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g1.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
						</div>
					</div>
					<div class="item">
						<div class="row">
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g1.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g2.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g3.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g4.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
						</div>
					</div>
					<div class="item">
						<div class="row">
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g1.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g2.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g3.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
							<div class="col-md-3 col-sm-3 col-xs-3 slidering">
								<div class="thumbnail"><img src="~/images/g4.jpg" alt="Image" style="max-width:100%;"></div>
							</div>
						</div>
					</div>
				</div>
				<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
					<span class="fa fa-chevron-left" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a>
				<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
					<span class="fa fa-chevron-right" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
				<!-- The Modal -->

			</div>
		</div>

		<div class="clearfix"> </div>
	</div>
	<!-- /newsletter-->
	<div class="newsletter_w3layouts_agile">
		<div class="col-sm-6 newsleft">
			<h3>Sign up for Newsletter !</h3>
		</div>
		<div class="col-sm-6 newsright">
			<form action="#" method="post">
				<input type="email" placeholder="Enter your email..." name="email" required="">
				<input type="submit" value="Submit">
			</form>
		</div>

		<div class="clearfix"></div>
	</div>
	<!-- //newsletter-->
	<!-- footer -->
	<div class="footer_agileinfo_w3">
		<div class="footer_inner_info_w3ls_agileits">
			<div class="col-md-3 footer-left">
				<h2><a href="index.html"><span>D</span>owny Shoes </a></h2>
				<p>Lorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora.</p>
				<ul class="social-nav model-3d-0 footer-social social two">
					<li>
						<a href="#" class="facebook">
							<div class="front"><i class="fa fa-facebook" aria-hidden="true"></i></div>
							<div class="back"><i class="fa fa-facebook" aria-hidden="true"></i></div>
						</a>
					</li>
					<li>
						<a href="#" class="twitter">
							<div class="front"><i class="fa fa-twitter" aria-hidden="true"></i></div>
							<div class="back"><i class="fa fa-twitter" aria-hidden="true"></i></div>
						</a>
					</li>
					<li>
						<a href="#" class="instagram">
							<div class="front"><i class="fa fa-instagram" aria-hidden="true"></i></div>
							<div class="back"><i class="fa fa-instagram" aria-hidden="true"></i></div>
						</a>
					</li>
					<li>
						<a href="#" class="pinterest">
							<div class="front"><i class="fa fa-linkedin" aria-hidden="true"></i></div>
							<div class="back"><i class="fa fa-linkedin" aria-hidden="true"></i></div>
						</a>
					</li>
				</ul>
			</div>
			<div class="col-md-9 footer-right">
				<div class="sign-grds">
					<div class="col-md-4 sign-gd">
						<h4>Our <span>Information</span> </h4>
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="about.html">About</a></li>
							<li><a href="404.html">Services</a></li>
							<li><a href="404.html">Short Codes</a></li>
							<li><a href="contact.html">Contact</a></li>
						</ul>
					</div>

					<div class="col-md-5 sign-gd-two">
						<h4>Store <span>Information</span></h4>
						<div class="address">
							<div class="address-grid">
								<div class="address-left">
									<i class="fa fa-phone" aria-hidden="true"></i>
								</div>
								<div class="address-right">
									<h6>Phone Number</h6>
									<p>+1 234 567 8901</p>
								</div>
								<div class="clearfix"> </div>
							</div>
							<div class="address-grid">
								<div class="address-left">
									<i class="fa fa-envelope" aria-hidden="true"></i>
								</div>
								<div class="address-right">
									<h6>Email Address</h6>
									<p>Email :<a href="mailto:example@email.com"> mail@example.com</a></p>
								</div>
								<div class="clearfix"> </div>
							</div>
							<div class="address-grid">
								<div class="address-left">
									<i class="fa fa-map-marker" aria-hidden="true"></i>
								</div>
								<div class="address-right">
									<h6>Location</h6>
									<p>
										Broome St, NY 10002,California, USA.

									</p>
								</div>
								<div class="clearfix"> </div>
							</div>
						</div>
					</div>
					<div class="col-md-3 sign-gd flickr-post">
						<h4>Flickr <span>Posts</span></h4>
						<ul>
							<li><a href="single.html"><img src="~/images/t1.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t2.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t3.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t4.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t1.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t2.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t3.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t2.jpg" alt=" " class="img-responsive" /></a></li>
							<li><a href="single.html"><img src="~/images/t4.jpg" alt=" " class="img-responsive" /></a></li>
						</ul>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			<div class="clearfix"></div>

			<p class="copy-right-w3ls-agileits">&copy 2018 Downy Shoes. All rights reserved | Design by <a href="http://w3layouts.com/">w3layouts</a></p>
		</div>
	</div>
</div>



<script>
	$(".value-plus").click(function () {
		console.log("Clicked value-plus button");
		// Thêm các dòng code xử lý tăng số lượng ở đây
	});

	$(".value-minus").click(function () {
		console.log("Clicked value-minus button");
		// Thêm các dòng code xử lý giảm số lượng ở đây
	});

	$('.entry.value-plus').click(function (event) {
		var itemId = $(this).data('itemid');
		var quantityElement = $(this).prev('.entry.value'); // lấy phần tử hiển thị số lượng
		// var quantityElement = $(this).next('.entry.value'); // lấy phần tử hiển thị số lượng

		console.log("so luong hien tai nut tang : ", quantityElement)

		var quantity = parseInt(quantityElement.text()) + 1; // Tăng giá trị lên 1
		quantityElement.text(quantity); // cập nhật số lượng hiển thị
		$(this).data('quantity', quantity); // cập nhật data-quantity

		// Lấy giá của sản phẩm từ HTML
		var itemPrice = parseFloat($(this).closest('tr').find('.item-price').text());

		// Tính toán giá tổng
		var newTotal = itemPrice * quantity;
		console.log("tong gia la : ", newTotal)
		// Cập nhật giá tổng trên giao diện
		$(this).closest('tr').find('.total-price').text(newTotal.toFixed(2));
		//$(this).closest('li').find('.total-price').text(newTotal.toFixed(2));

		// Gọi hàm cập nhật giỏ hàng
		updateCartQuantity(itemId, quantity);
		console.log("so sau khi tang", quantity);
	});
	// Giảm số lượng đi
	$(".value-minus").click(function () {
		var itemId = $(this).data('itemid');
		var quantityElement = $(this).next('.entry.value'); // lấy phần tử hiển thị số lượng
		var currentQuantity = parseInt(quantityElement.text()); // Lấy số lượng hiện tại
		var quantity = currentQuantity - 1;

		// Kiểm tra nếu số lượng mới là một số hợp lệ (lớn hơn hoặc bằng 1)
		if (!isNaN(quantity) && quantity >= 1) {
			quantityElement.text(quantity); // cập nhật số lượng hiển thị
			$(this).data('quantity', quantity); // cập nhật data-quantity

			// Lấy giá của sản phẩm từ HTML
			var itemPrice = parseFloat($(this).closest('tr').find('.item-price').text());

			// Tính toán giá tổng
			var newTotal = itemPrice * quantity;

			// Cập nhật giá tổng trên giao diện
			$(this).closest('tr').find('.total-price').text(newTotal.toFixed(2));
			//$(this).closest('li').find('.total-price').text(newTotal.toFixed(2));
			

		} else {
			// Nếu số lượng mới không hợp lệ, cập nhật số lượng hiển thị thành 1
			quantityElement.text(1);
			// Có thể hiển thị thông báo hoặc thực hiện hành động khác ở đây nếu cần
		}
		updateCartQuantity(itemId, quantity);
		console.log("so sau khi giam", quantity);
	});

	function updateCartQuantity(itemId, quantity) {
		$.ajax({
			url: '@Url.Action("UpdateCartQuantity", "Bills")', // Đảm bảo đường dẫn đúng
			type: 'POST',
			data: { productId: itemId, quantity: quantity },
			success: function (result) {
				console.log(result);
				if (result.status === 'success') {
					// Sau khi cập nhật số lượng thành công, cập nhật tổng giá trị đơn hàng
					updateTotalPrice();
				} else {
					// Hiển thị thông báo lỗi
					alert(result.message);
				}
			},
			error: function (xhr, status, error) {
				// Xử lý lỗi
				console.error("Error updating cart quantity:", error);
			}
		});
	}

	function updateTotalPrice() {
		$.ajax({
			url: '@Url.Action("GetTotalPrice", "Bills")', // Endpoint mới để lấy tổng giá trị đơn hàng
			type: 'GET',
			success: function (totalPrice) {
				// Cập nhật nội dung HTML của phần tổng giá trị đơn hàng
				$('.total-price-hd').text( totalPrice.toFixed(2));
			},
			error: function (xhr, status, error) {
				// Xử lý lỗi
				console.error("Error updating total price:", error);
			}
		});
	}

</script>


